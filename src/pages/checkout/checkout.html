<ion-header>
  <main-toolbar [showCartIcon] = "false"></main-toolbar>
</ion-header>
<ion-content class="f-size-larger">
  <ion-grid>

    <ion-row *ngIf="dataLoaded">
      <ion-col class="f-padding-lr-5">
        <!--<form ngNoForm action="https://lmi.paymaster.ua/" target="_blank" method="POST" *ngIf="pmtMethodID === 2">
          <input type="hidden" name="LMI_MERCHANT_ID" value="{{formInput?.LMI_MERCHANT_ID}}" />
          <input type="hidden" name="LMI_PAYMENT_NO" value="{{formInput?.LMI_PAYMENT_NO}}" />
          <input type="hidden" name="LMI_SUCCESS_URL" value="{{formInput?.LMI_SUCCESS_URL}}" />
          <input type="hidden" name="LMI_FAIL_URL" value="{{formInput?.LMI_FAIL_URL}}" />
          <input type="hidden" name="LMI_PAYMENT_AMOUNT" value="{{formInput?.LMI_PAYMENT_AMOUNT}}" />
          <input type="hidden" name="LMI_PAYMENT_DESC" value="{{formInput?.LMI_PAYMENT_DESC}}" />
          &lt;!&ndash;<input type="hidden" name="LMI_SIM_MODE" value="{{formInput?.LMI_SIM_MODE}}" />&ndash;&gt;
          <button class="f-btn-add-cart" ion-button block
                  [attr.disabled]="!validatePage().isValid?'':null"
                  (click)="onPlaceOrderClick()">Place your order</button>
        </form>-->

        <button class="f-btn-add-cart" ion-button block
                [attr.disabled]="!validatePage().isValid?'':null"
                (click)="onPlaceOrderClick()">Place your order</button>
      </ion-col>
    </ion-row>

<!--
    SUMMARY AREA
-->
    <ion-row>
      <ion-col class="f-page-header">Order summary
      </ion-col>
    </ion-row>


    <ion-row class="f-padding-lr-5" >
      <ion-grid class="f-grid-error-border-red" *ngIf="!validatePage().isValid">
        <ion-row>
          <ion-col>
            Your order contains errors. Please review order details below
          </ion-col>
        </ion-row>
      </ion-grid>
      <grid-hr></grid-hr>
      <ion-grid class="f-border-ligthgray" *ngIf="dataLoaded">
        <ion-row>
          <ion-col>
            Shipping to:
            <b>{{cart.order?.clientaddress?.recName}}</b>, {{cart.order?.clientaddress?.addressString}}
            <hr>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            Items ({{cart.cartItemsCount}}):
          </ion-col>
          <ion-col text-right col-auto>
            {{cart.itemsTotal | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            Shipping:
          </ion-col>
          <ion-col text-right col-auto>
            {{cart.shippingCost | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            Order Total:
          </ion-col>
          <ion-col text-right col-auto>
            <span class="f-color-red">{{cart.orderTotal | localeCurrency:userService.currency}}</span>
          </ion-col>
        </ion-row>


        <ion-row *ngIf="(cart.promoCodeDiscount>0)">
          <ion-col>
            Promocode discount:
          </ion-col>
          <ion-col text-right col-auto>
            - {{cart.promoCodeDiscount | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>


        <ion-row *ngIf="(cart.itemsBonusDisc>0)">
          <ion-col>
            Bonuses:
          </ion-col>
          <ion-col text-right col-auto>
            - {{cart.itemsBonusDisc | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>

        <ion-row *ngIf="cart.payByPromoBonus && (!(cart.availBonus === 0))">
          <ion-col>
            Promo bonuses:
          </ion-col>
          <ion-col text-right col-auto>
            - {{cart.itemsPromoBonusDisc | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <b>Grand Total:</b>
          </ion-col>
          <ion-col text-right col-auto>
            <span class="f-color-red"><b>{{cart.cartGrandTotal | localeCurrency:userService.currency}}</b></span>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-row>

<!--
    PAYMENT INFO AREA
-->

    <ion-row>
      <ion-col class="f-section-header"><b>Payment information</b>
      </ion-col>
    </ion-row>

    <ion-row class="f-padding-lr-5">
      <ion-grid class="f-border-ligthgray" *ngIf="dataLoaded">
        <ion-row>
          <ion-col>
            <b>Payment method</b>
            <br>
            {{ cart.pmtMethod.name }}
          </ion-col>
        </ion-row>
        <div *ngIf="cart.loan && (cart.pmtMethod.id === 3)">
          <hr>
          <credit-brief [creditAmt]="cart.cartGrandTotal" [credit]="cart.loan"></credit-brief>
        </div>
      </ion-grid>
    </ion-row>

    <promo-code *ngIf="dataLoaded"></promo-code>

<!--
   SHIPPING ITEMS AREA
-->
    <div *ngFor="let item of cart.orderProducts; let i = index">
      <ion-row>
        <ion-col class="f-section-header">
          <b>Shipment {{i+1}} of {{cart.orderProducts.length}}</b>
          <br>
          <span class="f-size-default">Item shipped from {{item?.quotationproduct?.quotation?.supplier?.name}}</span>
        </ion-col>
      </ion-row>

<!--
      <ion-row>
        <ion-col style="padding-left: 15px; padding-right: 15px; padding-top: 20px;">
          <b>Shipment {{i+1}} of {{cart.orderProducts.length}}</b>
          <br>
          Item shipped from {{item?.quotationproduct?.quotation?.supplier?.name}}
        </ion-col>
      </ion-row>
-->

      <ion-row class="f-padding-lr-5">
        <ion-grid class="f-border-ligthgray" *ngIf="dataLoaded">
          <ion-row>
            <ion-col>
              {{cart.loResultDeliveryOptions[i].loName}}
              <hr>
            </ion-col>
          </ion-row>

          <ion-row *ngIf="item.idStorePlace">
            <ion-col>
              Pickup at --
              <span class="f-color-green">{{item?.storeplace?.name}}, {{item?.storeplace?.address_line}}
                {{item?.storeplace?.city?.name}}</span>
              <hr>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col>
              Est. delivery date --
              <span class="f-color-green">{{cart.loResultDeliveryOptions[i].deliveryDate | date: 'fullDate'}}</span>
              <hr>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col col-auto>
              <div>
                <img class="f-img-item-80" [src]="item?.quotationproduct?.product?.imageUrl">
              </div>
            </ion-col>
            <ion-col no-padding>
              <ion-grid class="f-item-nopadding-tb">
                <ion-row>
                  <ion-col>
                    <span><b>{{item?.quotationproduct?.product.name}}</b></span>
                  </ion-col>
                </ion-row>

                <ion-row>
                  <ion-col class="f-item-padding-bottom">
                    <span class="f-color-red">{{item?.price |  localeCurrency:userService.currency}}</span>
                  </ion-col>
                </ion-row>

                <ion-row *ngIf="item?.quotationproduct?.product?.bonuses">
                  <ion-col class="f-item-padding-bottom" >
                    <bonus [bonusCnt]="item?.quotationproduct?.product?.bonuses"></bonus>
                  </ion-col>
                </ion-row>


                <ion-row *ngIf="item.errorMessage">
                  <ion-col class="f-size-small">
                    <error [errorText]="item?.errorMessage"></error>
<!--
                    <span class="f-size-small f-color-red">{{item?.errorMessage}}</span>
-->
                  </ion-col>
                </ion-row>

              </ion-grid>


            </ion-col>

          </ion-row>
          <ion-row>
            <ion-col class="f-item-padding-bottom">
              <dropdown-list id="btnQty" [reference]="item"
                             [afterUpdate] = "onAfterQtyUpdate"
                             [map]="{valueName:'qty', displayName:'qty'}"
                             [options]="{popupHeader:'Quantity', buttonHeader:'Qty', buttonClass:'f-drop-button-block'}"
                             [isQty]="true">
              </dropdown-list>
            </ion-col>
          </ion-row>


        </ion-grid>
      </ion-row>

    </div>

    <ion-row *ngIf="dataLoaded">
      <ion-col class="f-padding-lr-5">
        <!--<form ngNoForm action="https://lmi.paymaster.ua/" target="_blank" method="POST" *ngIf="pmtMethodID === 2">
          <input type="hidden" name="LMI_MERCHANT_ID" value="{{formInput?.LMI_MERCHANT_ID}}" />
          <input type="hidden" name="LMI_PAYMENT_NO" value="{{formInput?.LMI_PAYMENT_NO}}" />
          <input type="hidden" name="LMI_SUCCESS_URL" value="{{formInput?.LMI_SUCCESS_URL}}" />
          <input type="hidden" name="LMI_FAIL_URL" value="{{formInput?.LMI_FAIL_URL}}" />
          <input type="hidden" name="LMI_PAYMENT_AMOUNT" value="{{formInput?.LMI_PAYMENT_AMOUNT}}" />
          <input type="hidden" name="LMI_PAYMENT_DESC" value="{{formInput?.LMI_PAYMENT_DESC}}" />
          &lt;!&ndash;<input type="hidden" name="LMI_SIM_MODE" value="{{formInput?.LMI_SIM_MODE}}" />&ndash;&gt;
          <button class="f-btn-add-cart" ion-button block
                  [attr.disabled]="!validatePage().isValid?'':null"
                  (click)="onPlaceOrderClick()">Place your order</button>
        </form>-->

        <button class="f-btn-add-cart" ion-button block
                [attr.disabled]="!validatePage().isValid?'':null"
                (click)="onPlaceOrderClick()">Place your order</button>
      </ion-col>
    </ion-row>

  </ion-grid>
</ion-content>
